---
import { cn } from '@/utils/styles';

interface Props {
  starCount?: number;
  className?: string;
}

const { starCount = 200, className = '' } = Astro.props;
const uniqueId = `stars-${Math.random().toString(36).slice(2, 9)}`;
---

<canvas 
  id={uniqueId}
  class={cn('absolute inset-0 w-full h-full', className)}
  data-star-count={starCount}
></canvas>

<script>
  import { gsap } from 'gsap';

  document.querySelectorAll('[id^="stars-"]').forEach((canvas) => {
    const canvasElement = canvas as HTMLCanvasElement;
    const starCount = parseInt(canvasElement.dataset.starCount || '200', 10);
    const ctx = canvasElement.getContext('2d')!;

    let stars: { x: number; y: number; radius: number; opacity: number }[] = [];
    let animations: gsap.core.Tween[] = [];

    function createStars() {
      animations.forEach(anim => anim.kill());
      animations = [];
      stars = [];

      for (let i = 0; i < starCount; i++) {
        stars.push({
          x: Math.random() * canvasElement.width,
          y: Math.random() * canvasElement.height,
          radius: Math.random() * 1.5,
          opacity: Math.random()
        });
      }

      stars.forEach((star) => {
        const anim = gsap.to(star, {
          opacity: Math.random(),
          duration: 1 + Math.random() * 2,
          repeat: -1,
          yoyo: true,
          ease: "power1.inOut",
          delay: Math.random() * 2
        });
        animations.push(anim);
      });
    }

    function resizeCanvas() {
      canvasElement.width = canvasElement.offsetWidth;
      canvasElement.height = canvasElement.offsetHeight;
      createStars();
    }
    
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    function drawStars() {
      ctx.clearRect(0, 0, canvasElement.width, canvasElement.height);
      
      stars.forEach(star => {
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(245, 245, 245, ${star.opacity})`;
        ctx.fill();
      });
      
      requestAnimationFrame(drawStars);
    }
    
    drawStars();
  });
</script>